<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Ingeniería en Recursos Hídricos</title>

<style>
:root{
  --bg:#eef3f8;
  --card:#ffffff;
  --curso:#dbe7f2;
  --aprobado:#b6d7f2;
  --plan:#c7d8ea;
  --bloqueado:#e4e9ef;
  --texto:#1e2a36;
  --accent:#5a86ad;
}
body.dark{
  --bg:#0f1720;
  --card:#18222d;
  --curso:#223040;
  --aprobado:#2f5f8a;
  --plan:#355d82;
  --bloqueado:#2a3440;
  --texto:#e6edf3;
  --accent:#7aa7d8;
}
body{
  font-family:"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--texto);
  padding:20px;
}
h1{text-align:center}
.panel{
  max-width:1200px;
  margin:0 auto 20px;
  background:var(--card);
  padding:15px;
  border-radius:14px;
}
.barra{
  height:14px;
  background:#cdd8e3;
  border-radius:8px;
  overflow:hidden;
}
.barra div{
  height:100%;
  background:var(--accent);
}
.controles{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:space-between;
}
button{
  background:var(--accent);
  color:white;
  border:none;
  border-radius:8px;
  padding:6px 10px;
  cursor:pointer;
}
.malla{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:14px;
}
.anio{
  grid-column:span 2;
  text-align:center;
  font-weight:bold;
  color:var(--accent);
}
.sem h3{
  background:var(--accent);
  color:white;
  border-radius:8px;
  text-align:center;
  cursor:pointer;
  font-size:13px;
  padding:4px;
}
.curso{
  background:var(--curso);
  border-radius:10px;
  padding:6px;
  font-size:12px;
  margin-top:6px;
  cursor:pointer;
}
.aprobado{
  background:var(--aprobado);
  text-decoration:line-through;
}
.plan{
  outline:2px dashed var(--accent);
}
.bloqueado{
  background:var(--bloqueado);
  color:#7a8a9a;
  cursor:not-allowed;
}
.bloqueado:hover::after{
  content:attr(data-tooltip);
  position:absolute;
  background:#111;
  color:white;
  padding:6px;
  font-size:11px;
  border-radius:8px;
  white-space:pre-line;
}
</style>
</head>

<body>

<h1>Malla Ingeniería en Recursos Hídricos</h1>

<div class="panel">
  <div id="creditos"></div>
  <div class="barra"><div id="prog"></div></div>

  <div class="controles">
    <label><input type="checkbox" id="modoPlan"> Modo planificación</label>
    <label><input type="checkbox" id="modoOscuro"> Modo oscuro</label>
    <button onclick="exportar()">Exportar progreso</button>
    <button onclick="importar()">Importar progreso</button>
  </div>

  <hr>

  <strong>Prácticas</strong><br>
  <label><input type="checkbox" onchange="togglePractica(1)"> Práctica I</label>
  <label><input type="checkbox" onchange="togglePractica(2)"> Práctica II</label>
  <label><input type="checkbox" onchange="togglePractica(3)"> Práctica III</label>
  <label><input type="checkbox" onchange="togglePractica(4)"> Práctica IV</label>
</div>

<div class="malla" id="malla"></div>

<script>
const TOTAL=300;

const cursos=[
  {id:"calculo1",n:"Cálculo I",c:6,sem:1,r:[]},
  {id:"algebra_geom",n:"Álgebra y Geometría",c:6,sem:1,r:[]},
  {id:"quimica",n:"Química General",c:5,sem:1,r:[]},
  {id:"prog1",n:"Programación I",c:5,sem:1,r:[]},
  {id:"intro_hidro",n:"Introducción a la Hidrología",c:4,sem:1,r:[]},
  {id:"ingles1",n:"Inglés I",c:2,sem:1,r:[]},

  {id:"calculo2",n:"Cálculo II",c:6,sem:2,r:["calculo1"]},
  {id:"algebra_lin",n:"Álgebra Lineal",c:6,sem:2,r:["algebra_geom"]},
  {id:"geologia",n:"Geología y Geomorfología",c:5,sem:2,r:[]},
  {id:"fisica",n:"Física General",c:5,sem:2,r:["calculo1"]},
  {id:"socio_gen",n:"Sociología General",c:4,sem:2,r:[]},
  {id:"ingles2",n:"Inglés II",c:2,sem:2,r:["ingles1"]},

  {id:"calculo3",n:"Cálculo III",c:6,sem:3,r:["calculo2"]},
  {id:"ed",n:"Ecuaciones Diferenciales",c:5,sem:3,r:["algebra_lin","calculo2"]},
  {id:"eco_gen",n:"Ecología General",c:5,sem:3,r:["quimica"]},
  {id:"termo",n:"Termodinámica",c:5,sem:3,r:["fisica","quimica"]},
  {id:"socio_rural",n:"Sociología Rural",c:5,sem:3,r:["socio_gen"]},
  {id:"ingles3",n:"Inglés III",c:2,sem:3,r:["ingles2"]},

  {id:"mf",n:"Mecánica de Fluidos",c:6,sem:4,r:["ed","fisica"]},
  {id:"prob",n:"Probabilidades y Estadística",c:5,sem:4,r:["calculo2","algebra_lin"]},
  {id:"clima",n:"Climatología",c:5,sem:4,r:["termo"]},
  {id:"prog2",n:"Programación II",c:5,sem:4,r:["prog1"]},
  {id:"agua_soc",n:"Agua y Sociedad",c:5,sem:4,r:["socio_rural"]},
  {id:"ingles4",n:"Inglés IV",c:2,sem:4,r:["ingles3"]},

  {id:"micro",n:"Micro y Macroeconomía",c:5,sem:5,r:["calculo3"]},
  {id:"estad_ap",n:"Estadística Aplicada",c:5,sem:5,r:["prob","calculo3"]},
  {id:"suelo",n:"Ciencias del Suelo",c:6,sem:5,r:["quimica","geologia"]},
  {id:"isva",n:"Interacción Suelo–Vegetación–Atmósfera",c:6,sem:5,r:["clima"]},
  {id:"cc",n:"Componentes de Cambio Climático",c:4,sem:5,r:["socio_rural"]},

  {id:"finanzas",n:"Finanzas y Administración",c:5,sem:6,r:["micro"]},
  {id:"opt",n:"Optimización del Uso del Recurso Hídrico",c:4,sem:6,r:["calculo3","ed"]},
  {id:"calidad",n:"Calidad del Agua",c:5,sem:6,r:["mf","quimica"]},
  {id:"geomatica",n:"Geomática y Análisis Espacial",c:5,sem:6,r:["prog2","algebra_lin"]},
  {id:"hidro_sup",n:"Hidrología Superficial",c:6,sem:6,r:["estad_ap","mf"]},

  {id:"herr",n:"Herramientas de Análisis Económico y Social",c:4,sem:7,r:["agua_soc","finanzas"]},
  {id:"eco_acu",n:"Ecología de Sistemas Acuáticos",c:4,sem:7,r:["eco_gen"]},
  {id:"hidro_sub",n:"Hidrología Subterránea",c:6,sem:7,r:["suelo","hidro_sup"]},
  {id:"erosion",n:"Evaluación y Control de Procesos Erosivos",c:4,sem:7,r:["hidro_sup"]},
  {id:"conflicto",n:"Conflicto y Desarrollo Comunitario de Cuencas",c:5,sem:7,r:["agua_soc"]},

  {id:"eval_proj",n:"Evaluación de Proyectos",c:4,sem:8,r:["finanzas"]},
  {id:"eia",n:"Evaluación de Impacto Ambiental",c:4,sem:8,r:["eco_acu"]},
  {id:"modelacion",n:"Modelación Hidrológica",c:5,sem:8,r:["estad_ap"]},
  {id:"rest",n:"Restauración Hidrológica de Cuencas",c:5,sem:8,r:["erosion"]},
  {id:"valor",n:"Valoración de Servicios Ecosistémicos",c:5,sem:8,r:["herr","agua_soc"]},

  {id:"politica",n:"Política y Legislación del Agua",c:6,sem:9,r:["agua_soc"]},
  {id:"socio_hidro",n:"Estudios Socio-Hidrológicos",c:6,sem:9,r:["herr","valor"]},
  {id:"girh",n:"Gestión Integrada de Recursos Hídricos",c:6,sem:9,r:["conflicto","modelacion","opt"]},
  {id:"taller",n:"Taller de Memoria de Título",c:6,sem:9,r:["practica4"]},

  {id:"memoria",n:"Memoria de Título",c:30,sem:10,r:["taller"]}
];

let estado=JSON.parse(localStorage.getItem("estado"))||{};
let plan={};
let practicas=JSON.parse(localStorage.getItem("practicas"))||{};
let modoPlan=false;

function creditos(){
  return cursos.reduce((t,c)=>estado[c.id]?t+c.c:t,0);
}

function togglePractica(n){
  practicas["practica"+n]=!practicas["practica"+n];
  if(n===4 && practicas.practica4) estado.taller=true;
  localStorage.setItem("practicas",JSON.stringify(practicas));
  guardar();
}

function guardar(){
  localStorage.setItem("estado",JSON.stringify(estado));
  render();
}

function marcarSemestre(s){
  cursos.filter(c=>c.sem===s).forEach(c=>{
    if(modoPlan) plan[c.id]=true;
    else estado[c.id]=true;
  });
  guardar();
}

function render(){
  document.getElementById("creditos").textContent=
    `Créditos aprobados: ${creditos()} / ${TOTAL}`;
  document.getElementById("prog").style.width=
    (creditos()/TOTAL*100)+"%";

  const cont=document.getElementById("malla");
  cont.innerHTML="";

  for(let a=1;a<=5;a++){
    const h=document.createElement("div");
    h.className="anio";
    h.textContent=`Año ${a}`;
    cont.appendChild(h);
  }

  for(let s=1;s<=10;s++){
    const col=document.createElement("div");
    col.className="sem";
    col.innerHTML=`<h3 onclick="marcarSemestre(${s})">Semestre ${s}</h3>`;

    cursos.filter(c=>c.sem===s).forEach(c=>{
      const d=document.createElement("div");
      d.className="curso";
      d.textContent=c.n;

      let faltan=c.r.filter(r=>!estado[r]&&!plan[r]);
      if(estado[c.id]) d.classList.add("aprobado");
      else if(modoPlan&&plan[c.id]) d.classList.add("plan");
      else if(faltan.length){
        d.classList.add("bloqueado");
        d.dataset.tooltip="Falta aprobar:\n- "+faltan.map(
          x=>cursos.find(y=>y.id===x).n).join("\n- ");
      }

      d.onclick=()=>{
        if(d.classList.contains("bloqueado"))return;
        if(modoPlan) plan[c.id]=!plan[c.id];
        else estado[c.id]=!estado[c.id];
        guardar();
      };

      col.appendChild(d);
    });
    cont.appendChild(col);
  }
}

document.getElementById("modoPlan").onchange=e=>{
  modoPlan=e.target.checked;
  plan={};
  render();
};
document.getElementById("modoOscuro").onchange=e=>{
  document.body.classList.toggle("dark",e.target.checked);
};

function exportar(){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([JSON.stringify({estado,practicas})]));
  a.download="malla.json";
  a.click();
}
function importar(){
  const i=document.createElement("input");
  i.type="file";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      const d=JSON.parse(r.result);
      estado=d.estado||{};
      practicas=d.practicas||{};
      guardar();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

render();
</script>
</body>
</html>
