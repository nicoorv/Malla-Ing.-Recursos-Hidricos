<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Ingeniería en Recursos Hídricos</title>

<style>
:root{
  --bg:#eef3f8;
  --card:#ffffff;
  --curso:#dbe7f2;
  --aprobado:#b6d7f2;
  --plan:#c7d8ea;
  --bloqueado:#e4e9ef;
  --texto:#1e2a36;
  --accent:#5a86ad;
}

/* modo oscuro */
body.dark{
  --bg:#0f1720;
  --card:#18222d;
  --curso:#223040;
  --aprobado:#2f5f8a;
  --plan:#355d82;
  --bloqueado:#2a3440;
  --texto:#e6edf3;
  --accent:#7aa7d8;
}

body{
  font-family:"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--texto);
  padding:20px;
}

h1{text-align:center;margin-bottom:10px}

.panel{
  max-width:1200px;
  margin:0 auto 20px;
  background:var(--card);
  padding:15px;
  border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

.barra{
  height:14px;
  background:#cdd8e3;
  border-radius:8px;
  overflow:hidden;
  margin-bottom:10px;
}
.barra div{
  height:100%;
  background:var(--accent);
  transition:width .3s;
}

.controles{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:space-between;
}

button{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:white;
  cursor:pointer;
}

.malla{
  display:grid;
  grid-template-columns: repeat(10,1fr);
  gap:16px;
}

.anio{
  background:var(--card);
  border-radius:14px;
  padding:10px;
}

.anio h2{
  text-align:center;
  font-size:15px;
  color:var(--accent);
}

.sem{
  margin-top:8px;
}

.sem h3{
  font-size:13px;
  text-align:center;
  cursor:pointer;
  background:var(--accent);
  color:white;
  border-radius:8px;
  padding:4px;
}

.curso{
  background:var(--curso);
  border-radius:10px;
  padding:6px;
  font-size:12px;
  margin-top:6px;
  cursor:pointer;
  position:relative;
}

.aprobado{
  background:var(--aprobado);
  text-decoration:line-through;
}

.plan{
  background:var(--plan);
  outline:2px dashed var(--accent);
}

.bloqueado{
  background:var(--bloqueado);
  color:#7a8a9a;
  cursor:not-allowed;
}

.bloqueado:hover::after{
  content:attr(data-tooltip);
  position:absolute;
  background:#111;
  color:white;
  padding:6px;
  font-size:11px;
  border-radius:8px;
  top:100%;left:0;
  white-space:pre-line;
  z-index:10;
}
</style>
</head>

<body>

<h1>Malla Ingeniería en Recursos Hídricos</h1>

<div class="panel">
  <div id="creditos"></div>
  <div class="barra"><div id="prog"></div></div>

  <div class="controles">
    <label><input type="checkbox" id="modoPlan"> Modo planificación</label>
    <label><input type="checkbox" id="modoOscuro"> Modo oscuro</label>
    <button onclick="exportar()">Exportar progreso</button>
    <button onclick="importar()">Importar progreso</button>
  </div>

  <hr>

  <strong>Prácticas</strong><br>
  <label><input type="checkbox" onchange="togglePractica(1)"> Práctica I</label>
  <label><input type="checkbox" onchange="togglePractica(2)"> Práctica II</label>
  <label><input type="checkbox" onchange="togglePractica(3)"> Práctica III</label>
  <label><input type="checkbox" onchange="togglePractica(4)"> Práctica IV</label>
</div>

<div class="malla" id="malla"></div>


<script>
const TOTAL=300;

const cursos=[
{id:"calculo1",n:"Cálculo I",c:6,a:1,s:1,r:[]},
{id:"calculo2",n:"Cálculo II",c:6,a:1,s:2,r:["calculo1"]},
{id:"calculo3",n:"Cálculo III",c:6,a:2,s:1,r:["calculo2"]},
{id:"mf",n:"Mecánica de Fluidos",c:6,a:2,s:2,r:["calculo3"]},
{id:"hidro_sup",n:"Hidrología Superficial",c:6,a:3,s:1,r:["mf"]},
{id:"hidro_sub",n:"Hidrología Subterránea",c:6,a:4,s:1,r:["hidro_sup"]},
{id:"taller",n:"Taller de Memoria",c:6,a:5,s:1,r:["practica4"]},
{id:"memoria",n:"Memoria de Título",c:30,a:5,s:2,r:["taller"]}
];

let estado=JSON.parse(localStorage.getItem("estado"))||{};
let plan={};
let practicas=JSON.parse(localStorage.getItem("practicas"))||{};
let modoPlan=false;

function creditos(){
  return cursos.reduce((t,c)=>estado[c.id]?t+c.c:t,0);
}

function togglePractica(n){
  practicas["practica"+n]=!practicas["practica"+n];
  if(n===4 && practicas.practica4) estado.taller=true;
  localStorage.setItem("practicas",JSON.stringify(practicas));
  guardar();
}

function guardar(){
  localStorage.setItem("estado",JSON.stringify(estado));
  render();
}

function marcarSemestre(a,s){
  cursos.filter(c=>c.a===a&&c.s===s).forEach(c=>{
    if(modoPlan) plan[c.id]=true;
    else estado[c.id]=true;
  });
  guardar();
}

function render(){
  document.getElementById("creditos").textContent =
    `Créditos aprobados: ${creditos()} / ${TOTAL}`;
  document.getElementById("prog").style.width =
    (creditos()/TOTAL*100)+"%";

  const cont = document.getElementById("malla");
  cont.innerHTML = "";

  // fila superior: años (cada uno ocupa 2 columnas)
  for(let a=1;a<=5;a++){
    const header = document.createElement("div");
    header.style.gridColumn = `${(a-1)*2+1} / span 2`;
    header.style.textAlign = "center";
    header.style.fontWeight = "bold";
    header.style.color = "var(--accent)";
    header.textContent = `Año ${a}`;
    cont.appendChild(header);
  }

  // semestres
  for(let s=1;s<=10;s++){
    const col = document.createElement("div");
    col.className = "sem";

    col.innerHTML = `<h3 onclick="marcarSemestre(${Math.ceil(s/2)},${s%2===0?2:1})">
      Semestre ${s}
    </h3>`;

    cursos.filter(c => c.s === s).forEach(c=>{
      const d = document.createElement("div");
      d.className = "curso";
      d.textContent = c.n;

      let faltan=[];
      c.r.forEach(r=>{
        if(!estado[r] && !plan[r]) faltan.push(r);
      });

      if(estado[c.id]) d.classList.add("aprobado");
      else if(modoPlan && plan[c.id]) d.classList.add("plan");
      else if(faltan.length){
        d.classList.add("bloqueado");
        d.dataset.tooltip = "Falta aprobar:\n- " + faltan.join("\n- ");
      }

      d.onclick = ()=>{
        if(d.classList.contains("bloqueado")) return;
        if(modoPlan) plan[c.id] = !plan[c.id];
        else estado[c.id] = !estado[c.id];
        guardar();
      };

      col.appendChild(d);
    });

    cont.appendChild(col);
  }
}

document.getElementById("modoPlan").onchange=e=>{
  modoPlan=e.target.checked;
  plan={};
  render();
};

document.getElementById("modoOscuro").onchange=e=>{
  document.body.classList.toggle("dark",e.target.checked);
};

function exportar(){
  const data=JSON.stringify({estado,practicas});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([data]));
  a.download="malla.json";
  a.click();
}

function importar(){
  const i=document.createElement("input");
  i.type="file";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      const d=JSON.parse(r.result);
      estado=d.estado||{};
      practicas=d.practicas||{};
      guardar();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
}

render();
</script>
</body>
</html>
